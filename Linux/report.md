# __Отчет по индивидуальному проекту Linux студента школы 21 turkatrj__

   #### Оглавление

   - [Part 1. Установка ОС](#Part 1. Установка ОС)

   - [Part 2. Создание пользователя](#Part 2. Создание пользователя)

   - [Part 3. Настройка сети ОС](#Part 3. Настройка сети ОС)

   - [Part 4. Обновление ОС](#Part 4. Обновление ОС)

   - [Part 5. Использование команды sudo](#Part 5. Использование команды sudo)

   - [Part 6. Установка и настройка службы времени](#Part 6. Установка и настройка службы времени)

   - [Part 7. Установка и использование текстовых редакторов](#Part 7. Установка и использование текстовых редакторов)

   - [Part 8. Установка и базовая настройка сервиса SSHD](#Part 8. Установка и базовая настройка сервиса SSHD)

   - [Part 9. Установка и использование утилит top, htop](#Part 9. Установка и использование утилит top, htop)

   - [Part 10. Использование утилиты fdisk](#Part 10. Использование утилиты fdisk)

   - [Part 11. Использование утилиты df](#Part 11. Использование утилиты df)
   
   - [Part 12. Использование утилиты du](#Part 12. Использование утилиты du)

   - [Part 13. Установка и использование утилиты ncdu](#Part 13. Установка и использование утилиты ncdu)

   - [Part 14. Работа с системными журналами](#Part 14. Работа с системными журналами)

   - [Part 15. Использование планировщика заданий CRON](#Part 15. Использование планировщика заданий CRON)


<a name="Part 1. Установка ОС"></a> 
## Part 1. Установка ОС
Была произведена установка Ubuntu 20.04 Server LTS без графического интерфейса.
 
Программа для виртуализации - VirtualBox.
 
Версия Ubuntu:

![linux](/src/screenshots/1.png)


<a name="Part 2. Создание пользователя"></a> 
## Part 2. Создание пользователя
   Создание нового пользователя NewADMIN в группе adm:

   ![linux](/src/screenshots/2-1.png)

   Информация о новом пользователе в конце файла /etc/passwd:

   ![linux](/src/screenshots/2-2.png)

   Проверяем группу нового пользователя: `vim /etc/group`:

   ![linux](/src/screenshots/2-3.png)


<a name="Part 3. Настройка сети ОС"></a> 
## Part 3. Настройка сети ОС

   #### 1. Задать название машины вида user-1.

   Изменяем имя командой `sudo hostnamectl set-hostname user-1`.
   Далее проверяем имя командой `cat /etc/hostname`.

   ![linux](/src/screenshots/3-1.png)

   После перезагрузки машины название в командной строке изменилось:

   ![linux](/src/screenshots/3-2.png)

   #### 2. Установить временную зону, соответствующую вашему текущему местоположению.

   Проверяем время командой `date` и устанавливаем временную зону командой `sudo timedatectl set-timezone Europe/Moscow`. Далее проверям с помощью `timedatectl`:

   ![linux](/src/screenshots/3-3.png)

   #### 3. Вывести названия сетевых интерфейсов с помощью консольной команды.

   Выполняем команду `ls /sys/class/net`:

   ![linux](/src/screenshots/3-4.png)  

   eth0 – интерфейс, связанный с сетевой картой, работающей через Ethernet (по кабелю). В выводе выше можно увидеть множество полезной информации, например, ip-адрес, привязанный к этому интерфейсу. Если бы сетевых карт было несколько, то кроме eth0, мы бы увидели eth1 и так далее.

   lo (loopback device) – виртуальный интерфейс, присутствующий по умолчанию в любом Linux. Он используется для отладки сетевых программ и запуска серверных приложений на локальной машине (локальный сетевой интерфейс, который всегда указывает на текущий компьютер). С этим интерфейсом всегда связан адрес 127.0.0.1. У него есть dns-имя – localhost. Посмотреть привязку можно в файле /etc/hosts.


   #### 4. Используя консольную команду получить ip адрес устройства, на котором вы работаете, от DHCP сервера.

   DHCP (англ. Dynamic Host Configuration Protocol — протокол динамической настройки узла) — прикладной протокол, позволяющий сетевым устройствам автоматически получать IP-адрес и другие параметры, необходимые для работы в сети TCP/IP. Данный протокол работает по модели «клиент-сервер». Для автоматической конфигурации компьютер-клиент на этапе конфигурации сетевого устройства обращается к так называемому серверу DHCP и получает от него нужные параметры.

   Узнать IP-адресс устройства можно узнать командами `ip r` или `hostname –I` :

   ![linux](/src/screenshots/3-5.png) 

   #### 5. Определить и вывести на экран внешний ip-адрес шлюза (ip) и внутренний IP-адрес шлюза, он же ip-адрес по умолчанию (gw).

   Внутренний адрес шлюза можно узнать комадой `ip route | grep default`. Внешний узнаем командой `wget -qO- eth0.me`

   ![linux](/src/screenshots/3-5.png)

   #### 6. Задать статичные (заданные вручную, а не полученные от DHCP сервера) настройки ip, gw, dns (использовать публичный DNS серверы, например 1.1.1.1 или 8.8.8.8).

   Чтобы задать статические настройки необходимо разрешить редактирования файла настроек `sudo chmod 777 /etc/netplan/00-installer-config.yaml`.

   И редактируем файл командой `vim /etc/netplan/00-installer-config.yaml`.

   Далее сохраняем изменения командой `sudo netplan apply`.

   ![linux](/src/screenshots/3-6.png)

   #### 7. Перезагрузить виртуальную машину. Убедиться, что статичные сетевые настройки (ip, gw, dns) соответствуют заданным в предыдущем пункте.

Перезагружаем машину командой reboot и проверяем настройки, после чего пингуем 5-ю пакетами удаленные хосты 1.1.1.1 и ya.ru

![linux](/src/screenshots/3-7.png)


<a name="Part 4. Обновление ОС"></a> 
## Part 4. Обновление ОС

Обновляем все пакеты до последних версий командой `sudo apt update`.

Затем обновляем установленные пакеты до последних доступных версий `sudo apt upgrade`.

После завершения используем команду `sudo apt dist-upgrade`, которая выполнит любые дополнительные обновления, связанные с изменением зависимостей, а также с добавлением или удалением пакетов по мере необходимости. Эта команда обработает набор обновлений, которые могли быть отложены во время предыдущих операций. Вызываем комнады повторно, после установки новых обновлений нет.

![linux](/src/screenshots/4-1.png)


<a name="Part 5. Использование команды sudo"></a> 
## Part 5. Использование команды sudo

Sudo – это утилита для операционных систем семейства Linux, позволяющая пользователю запускать программы с привилегиями другой учётной записи, как правило, суперпользователя. В части запуска команд от имени root’а sudo является альтернативой утилите su. Правда, в отличие от su, которая запускает оболочку root’а и предоставляет суперполномочия всем дальнейшим инструкциям, sudo предоставляет только временное повышение привилегий.

Командой `sudo usermod -a -G sudo new_user` разрешаем пользователю использовать sudo.

Командой `su NewADMIN` меняем пользователя и меняем название hostname ОС с помощью `sudo hostnamectl set-hostname user-3`. После перезагрузки название отображается корректно.

![linux](/src/screenshots/5-1.png)


<a name="Part 6. Установка и настройка службы времени"></a> 
## Part 6. Установка и настройка службы времени

Командой `date` смотрим текущее время, так же проверяем командой `timedatectl` и `timedatectl show`.
При смене часового пояса ранее был активирован  NTPD (Network Time Protocol daemon).

![linux](/src/screenshots/6-1.png)


<a name="Part 7. Установка и использование текстовых редакторов"></a> 
## Part 7. Установка и использование текстовых редакторов

#### 1. Установить текстовые редакторы VIM (+ любые два по желанию NANO, MCEDIT, JOE).

Для установки текстового редактора используем `sudo apt install <имя__текстового_редактора>`.

#### 2. Используя каждый из трех выбранных редакторов, создайте файл test_X.txt, где X -- название редактора, в котором создан файл. Напишите в нём свой никнейм, закройте файл с сохранением изменений.

Текстовый редактор VIM:

- Создаем файл с помощью команды `vim test_vim.txt`

- Нажимаем "i" для перехода в режим редактирования и ишем ник: "turkatrj"

- Для выхода с сохранением нажимем Esc вводим команду :wq и нажимаем Enter

![linux](/src/screenshots/7-2-vim.png)

Текстовый редактор NANO:

- Создаем файл с помощью команды nano test_nano.txt

- Пишем ник: "turkatrj"

- Для выхода нажимаем комбинацию ctrl+x для сохранения, соглашаемся клавишей Y и нажимаем Enter

![linux](/src/screenshots/7-2-nano.png)

Текстовый редактор MCEDIT:

- Cоздаем файл с помощью команды `mcedit test_mcedit.txt`

- Пишем ник: "turkatrj"

- Для выхода с сохранением нажимаем Esc и выбираем YES

![linux](/src/screenshots/7-2-mcedit.png)

#### 3. Используя каждый из трех выбранных редакторов, откройте файл на редактирование, отредактируйте файл, заменив никнейм на строку "21 School 21", закройте файл без сохранения изменений.

Текстовый редактор VIM:

- Открываем файл с помощью команды `vim test_vim.txt`

- Нажимаем "i" для перехода в режим редактирования изменяем ник на "21 School 21"

- Для выхода без сохранения нажимаем Esc вводим команду :q! и нажимаем Enter

![linux](/src/screenshots/7-3-vim.png)

Текстовый редактор NANO:

- Открываем файл с помощью команды `nano test_nano.txt`

- Изменяем ник на "21 School 21"

- Для выхода без сохранения нажимаем комбинацию ctrl+x и клавишу N

![linux](/src/screenshots/7-3-nano.png)

Текстовый редактор MCEDIT:

- Открываем файл с помощью команды `mcedit test_mcedit.txt`

- Изменяем ник на "21 School 21"

- Для выхода без сохранения нажимаем Esc, а затем NO

![linux](/src/screenshots/7-3-mcedit.png)

#### 4. Используя каждый из трех выбранных редакторов, отредактируйте файл ещё раз (по аналогии с предыдущим пунктом), а затем освойте функции поиска по содержимому файла (слово) и замены слова на любое другое.

Текстовый редактор VIM:

- Открываем файл с помощью команды `vim test_vim.txt`

- Для поиска в VIM вводим / и искомое слово turkatrj

![linux](/src/screenshots/7-4-vim.png)

- Для замены слова в VIM вводим :%s/<изначальное_слово>/<измененное_слово>

![linux](/src/screenshots/7-4-1-vim.png)


Текстовый редактор NANO:

- Открываем файл с помощью команды `nano test_nano.txt`

- Для поиска нажимаем ctrl + W

![linux](/src/screenshots/7-4-nano.png)

- Для замены слова в NANO нажимаем ctrl + \ и пишем заменяемое слово, нажимаем Enter, пишем заменяющее слово, нажимаем Enter, выбираем YES

![linux](/src/screenshots/7-4-1-nano.png)


Текстовый редактор MCEDIT:

- Открываем файл с помощью команды `mcedit test_mcedit.txt`

- Для поиска в mcedit нажимаем F7, затем вводим слово, которое хотим найти

![linux](/src/screenshots/7-4-mcedit.png)

- Для замены слова в mcedit нажимаем F4, затем вводим заменяемое слово, нажимаем стрелку вниз и пишем слово-замену, далее ENTER

![linux](/src/screenshots/7-4-1-mcedit.png)


<a name="Part 8. Установка и базовая настройка сервиса SSHD"></a> 
## Part 8. Установка и базовая настройка сервиса SSHD

#### 1. Установить службу SSHd.

Устанавливаем службу SSHd командой `sudo apt-get install ssh` и `sudo apt install openssh-server`.

Проверяем наличие командой `ssh -V`:

![linux](/src/screenshots/8-1.png)

#### 2. Добавить автостарт службы при загрузке системы.

Добавляем автостарт службы SSHd командой `sudo systemctl enable ssh`.

#### 3. Перенастроить службу SSHd на порт 2022.

Открываем настройки командой `sudo vim /etc/ssh/sshd_config`.

Изменяем порт SSHd: строку `#Port 22` заменяем на `Port 2022` :

![linux](/src/screenshots/8-3.png)

#### 4. Используя команду ps, показать наличие процесса sshd. Для этого к команде нужно подобрать ключи.

Вводим команду `ps ax | grep sshd` (флаг -a оставляет все процессы, кроме лидеров сеансов и процессов, не связанных с терминалом, флаг -x заставляет ps отображать список всех процессов, которыми вы владеете) или `ps -C sshd` (флаг -C фильтрует процессы по указанной строке)

![linux](/src/screenshots/8-3.png)

#### 5. Перезагрузить систему.

Перезагружаем систему командой `reboot`.

Устанавливаем net-tools командой `sudo apt install net-tools`. Выполняем команду `netstat -tan`:

![linux](/src/screenshots/8-5.png)

Значения флагов:
- a - Отображение всех подключений и ожидающих портов.
- n - Отображение адресов и номеров портов в числовом формате.
- t - Отображение текущего подключения в состоянии переноса нагрузки с процессора на сетевой адаптер при передаче данных ( "offload", информация по протоколам TCP).

Значения колонок:
- Proto - тип протокола
- Recv-Q - Счётчик байт не скопированных программой пользователя из этого сокета
- Send-Q - Счётчик байтов, не подтверждённых удалённым узлом
- Local Address - IP -адрес локального компьютера и номер используемого порта
- Foreign Address - IP -адрес и номер порта удалённого компьютера, к которому подключен сокет если есть *, значит порт ещё не установлен
- State - указывает состояние TCP - соединения

State бывает:
- ESTABLISHED - соединение установлено
- SYN_SENT - сокет пытается установить соединение
- SYN_RECV - начальная синхронизация соединения
- FIN_WAIT1 - сокет закрыт, ожидание отключения соединения
- FIN_WAIT2 - ожидание отключения удаленной стороны
- TIME_WAIT - ожидание после закрытия повторной передачи отключения удаленной стороны
- CLOSED - соединение закрыто, сокет не используется
- CLOSE_WAIT - удаленный узел отключился, сокет скоро будет закрыт
- LAST_ACK - сначала отключилась удаленная сторона, а затем сокет будет закрыт
- LISTEN - сокет ожидает входящих соединений
- CLOSING - закрытие сокета, точнее сокет закрыт, а затем отключился удаленный узел
- UNKNOWN - состояние сокета неизвестно.


В выводе netstat 0.0.0.0 означает, что подключение может быть выполнено на любой внешний адрес.

<a name="Part 9. Установка и использование утилит top, htop"></a> 
## Part 9. Установка и использование утилит top, htop

Запускаем команду `top`:

![linux](/src/screenshots/9-1.png)

В первой строке:
- uptime - время 18:44:14 и "сеанс" 16 минут в первой строке
- количество авторизованных пользователей - 1
- общая загрузка системы - 0,0 0,0 0,2
Во второй строке:
- общее количество процессов - 95
В третьей строке:
- загрузку cpu
В четвертой и пятой строке:
- загрузка памяти
Ниже в таблице:
- pid процесса занимающего больше всего памяти - 1
- pid процесса, занимающего больше всего процессорного времени - 1

Для выхода из утилиты нажимаем Q.

Запускаем команду `htop`:

![linux](/src/screenshots/9-2.png)

Для выбора сортировки нажимаем F6. Отсортированый по PID:

![linux](/src/screenshots/9-3.png)

Отсортированый по PERCENT_CPU:

![linux](/src/screenshots/9-4.png)

Отсортированый по PERCENT_MEM:

![linux](/src/screenshots/9-5.png)

Отсортированый по TIME:

![linux](/src/screenshots/9-6.png)

Для фильтрации нажимаем F4. Отфильтрованный для процесса sshd:

![linux](/src/screenshots/9-7.png)

Для поиска нажимаем F3. Найденный процессом syslog, для следующего совпадения нажать F3:

![linux](/src/screenshots/9-8.png)

Для добавления вывода hostname, clock и uptime нажимаем F2:

![linux](/src/screenshots/9-9.png)


<a name="Part 10. Использование утилиты fdisk"></a> 
## Part 10. Использование утилиты fdisk

Запускаем утилиту командой `sudo fdisk -l`:

![linux](/src/screenshots/10.png)

- Название жесткого диска VBOX HARDDISK
- размер - 35 GiB
- количество секторов - 73400320

Используем команду `free -h` для определения размера swap:

![linux](/src/screenshots/10-2.png)

<a name="Part 11. Использование утилиты df"></a> 
## Part 11. Использование утилиты df

Вводим команды `df` и `df /` :

![linux](/src/screenshots/11-1.png)

- Размер раздела - 16849719 Кб

- Размер занятого пространства - 4844816 Кб

- Размер свободного пространства - 11123644 Кб

- Процент использования - 31%

Для размерности можно использовать флаги:

- B - изменить размер одного блока перед выводом данных, например, можно использовать BM, чтобы вывести все данные в мегабайтах;
- h - выводить размеры в читаемом виде, в мегабайтах или гигабайтах;
- H - выводить все размеры в гигабайтах;
- k - выводить размеры в килобайтах;

Вводим команды `df -Th` и `df -Th /` :

![linux](/src/screenshots/11-2.png)

- Размер раздела - 17
- Размер занятого пространства - 4,7 Gb
- Размер свободного пространства - 11 Gb
- Процент использования - 31%
- Nип файловой системы для раздела - ext4


<a name="Part 12. Использование утилиты du"></a> 
## Part 12. Использование утилиты du

#### 1. Запустить команду du.

![linux](/src/screenshots/12-1.png)

#### 2. Вывести размер папок /home, /var, /var/log (в байтах, в человекочитаемом виде)

![linux](/src/screenshots/12-2.png)

#### 3. Вывести размер всего содержимого в /var/log (не общее, а каждого вложенного элемента, используя *)

![linux](/src/screenshots/12-3.png)


<a name="Part 13. Установка и использование утилиты ncdu"></a> 
## Part 13. Установка и использование утилиты ncdu

Командой `sudo apt install ncdu` устанавливаем ncdu. Размер папки /home:

![linux](/src/screenshots/13-1.png)

Размер папки /var:

![linux](/src/screenshots/13-2.png)

Размер папки /var/log:

![linux](/src/screenshots/13-3.png)

<a name="Part 14. Работа с системными журналами"></a> 
## Part 14. Работа с системными журналами

Открываем файлы с помощью `vim /var/log/<имя_файла>`.

Файл /var/log/dmesg:

![linux](/src/screenshots/14-1.png)

Файл /var/log/syslog:

![linux](/src/screenshots/14-2.png)

Файл /var/log/auth.log:

![linux](/src/screenshots/14-3.png)

Для просмотра последней авторизации, имени пользователя и метода входа в систему используем команду `last`:

![linux](/src/screenshots/14-4.png)

- Время последней успешной авторизации - Jul 19 18:28

- Имя пользователя - turkatrj

- Метод входа в систему - tty1


Перезапускаем службу SSHd командой `service sshd restart` :

![linux](/src/screenshots/14-5.png)

Выводим сообщение о рестарте служб командой `cat /var/log/syslog` :

![linux](/src/screenshots/14-6.png)

<a name="Part 15. Использование планировщика заданий CRON"></a> 
## Part 15. Использование планировщика заданий CRON


Вызываем планировщик заданий `crontab -e` и выбираем текстовый редактор Vim:

![linux](/src/screenshots/15-1.png)

Добавляем задание выполнить uptime каждые 2 минуты (можно вместо команды указать адрес скрипта):

![linux](/src/screenshots/15-2.png)

Находим в системных журналах строчки работы CRON (3 раза) с помощью команды `cat /var/log/syslog`:

![linux](/src/screenshots/15-4.png)

Команда `crontab -l` отображает список текущих задач:

![linux](/src/screenshots/15-3.png)

Удаляем задачи с помощью команды `crontab -r` (или сами редактируем файл, как описано выше) и отображаем список задач `crontab -l`:

![linux](/src/screenshots/15-5.png)
